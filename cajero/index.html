<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel del Cajero - Saki Sushi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #D32F2F; --secondary: #212121; --accent: #FF9800;
            --light: #F5F5F5; --dark: #121212; --warm: #FFC107;
            --success: #388E3C; --info: #1976D2; --warning: #F57C00; --danger: #ef4444;
            --shadow: rgba(0, 0, 0, 0.15); --transition: all 0.3s ease;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Roboto', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); min-height: 100vh; padding: 20px; color: var(--secondary); }
        
        .tasa-bar { background: linear-gradient(135deg, #b91c1c, var(--primary)); padding: 1rem 2rem; margin: -20px -20px 20px -20px; display: flex; justify-content: center; align-items: center; gap: 2rem; flex-wrap: wrap; box-shadow: 0 5px 20px rgba(0,0,0,0.3); }
        .tasa-display { display: flex; align-items: center; gap: 1rem; color: white; font-size: 1.1rem; }
        .tasa-value { font-size: 2rem; font-weight: 700; background: rgba(255,255,255,0.2); padding: 0.5rem 1rem; border-radius: 0.5rem; }
        .tasa-input { width: 120px; padding: 0.5rem; border: 2px solid rgba(255,255,255,0.3); border-radius: 0.5rem; background: rgba(255,255,255,0.1); color: white; font-size: 1.1rem; font-weight: 600; text-align: center; }
        .tasa-input::placeholder { color: rgba(255,255,255,0.6); }
        .btn-tasa { background: rgba(255,255,255,0.2); border: 2px solid white; color: white; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-weight: 600; transition: var(--transition); }
        .btn-tasa:hover { background: white; color: var(--primary); }
        
        .container { max-width: 1400px; margin: 0 auto; background: var(--light); border-radius: 15px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, var(--primary), #B71C1C); color: white; padding: 25px 30px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; }
        .header-left h1 { font-size: 2.5em; font-family: 'Montserrat', sans-serif; font-weight: 800; margin-bottom: 5px; }
        .header-left p { opacity: 0.9; font-size: 1.1em; }
        .header-right { display: flex; align-items: center; gap: 20px; }
        .sync-status { background: rgba(255,255,255,0.2); padding: 10px 20px; border-radius: 25px; font-size: 0.9em; display: flex; align-items: center; gap: 10px; font-family: 'Montserrat', sans-serif; }
        .sync-status.online { background: rgba(56, 142, 60, 0.3); }
        .sync-status.offline { background: rgba(211, 47, 47, 0.3); }
        .sync-status.syncing { background: rgba(255, 152, 0, 0.3); }
        
        .nav-tabs { background: var(--secondary); display: flex; padding: 0 30px; gap: 10px; overflow-x: auto; }
        .nav-tab { background: transparent; color: white; border: none; padding: 20px 30px; font-size: 1em; cursor: pointer; transition: var(--transition); font-family: 'Montserrat', sans-serif; font-weight: 500; border-bottom: 3px solid transparent; white-space: nowrap; }
        .nav-tab:hover { background: rgba(255,255,255,0.1); }
        .nav-tab.active { border-bottom-color: var(--accent); color: var(--accent); }
        
        .content { padding: 30px; }
        .section { display: none; }
        .section.active { display: block; }
        .section-title { font-size: 2em; color: var(--secondary); margin-bottom: 25px; display: flex; align-items: center; gap: 15px; font-family: 'Montserrat', sans-serif; font-weight: 700; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        @media (max-width: 992px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 576px) { .stats-grid { grid-template-columns: 1fr; } }
        
        .stat-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 5px 20px var(--shadow); text-align: center; transition: var(--transition); cursor: pointer; border: 2px solid transparent; }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,0,0,0.15); border-color: var(--accent); }
        .stat-icon { width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; font-size: 1.5em; color: white; }
        .stat-icon.pendientes { background: var(--warning); }
        .stat-icon.cobrados { background: var(--success); }
        .stat-icon.ventas { background: var(--info); }
        .stat-icon.platillos { background: var(--primary); }
        .stat-value { font-size: 2.5em; font-weight: 800; color: var(--secondary); font-family: 'Montserrat', sans-serif; }
        .stat-label { color: #666; margin-top: 5px; font-size: 0.95em; }
        
        .orders-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 30px; }
        @media (max-width: 1200px) { .orders-container { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 768px) { .orders-container { grid-template-columns: 1fr; } }
        
        .order-column { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 5px 20px var(--shadow); }
        .order-column-header { background: linear-gradient(135deg, var(--secondary), #424242); color: white; padding: 15px 20px; font-family: 'Montserrat', sans-serif; font-weight: 700; display: flex; align-items: center; gap: 10px; }
        .order-column-header.mesa { background: linear-gradient(135deg, var(--info), #1565C0); }
        .order-column-header.delivery { background: linear-gradient(135deg, var(--success), #2E7D32); }
        .order-column-header.reserva { background: linear-gradient(135deg, var(--warning), #F57C00); }
        .order-column-content { padding: 15px; min-height: 200px; max-height: 600px; overflow-y: auto; }
        
        .order-card { background: #f8f8f8; border-radius: 10px; padding: 15px; margin-bottom: 15px; border-left: 4px solid var(--primary); transition: var(--transition); }
        .order-card:hover { transform: translateX(5px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .order-card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .order-id { font-weight: 700; font-family: 'Montserrat', sans-serif; font-size: 0.9rem; }
        .order-time { font-size: 0.8rem; color: #666; }
        .order-details { font-size: 0.9rem; margin-bottom: 10px; }
        .order-detail-row { display: flex; justify-content: space-between; padding: 3px 0; }
        .order-total { font-weight: 700; color: var(--primary); font-size: 1.1rem; text-align: right; margin-top: 10px; padding-top: 10px; border-top: 2px dashed #ddd; }
        .order-actions { display: flex; gap: 10px; margin-top: 15px; }
        
        .btn { flex: 1; padding: 10px; border: none; border-radius: 8px; font-size: 0.9em; font-weight: 600; cursor: pointer; transition: var(--transition); display: flex; align-items: center; justify-content: center; gap: 8px; font-family: 'Montserrat', sans-serif; }
        .btn-cobrar { background: linear-gradient(135deg, var(--success), #2E7D32); color: white; }
        .btn-cobrar:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(56, 142, 60, 0.4); }
        .btn-ver { background: #e0e0e0; color: var(--secondary); }
        .btn-ver:hover { background: #d0d0d0; }
        .btn-rechazar { background: linear-gradient(135deg, var(--danger), #B71C1C); color: white; }
        
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 3000; display: none; justify-content: center; align-items: center; padding: 20px; backdrop-filter: blur(5px); }
        .modal-overlay.show { display: flex; }
        .modal-content { background: white; border-radius: 20px; max-width: 700px; width: 100%; max-height: 90vh; overflow-y: auto; animation: slideUp 0.3s ease; }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .modal-header { background: linear-gradient(135deg, var(--success), #2E7D32); color: white; padding: 25px; display: flex; justify-content: space-between; align-items: center; }
        .modal-header h2 { font-family: 'Montserrat', sans-serif; font-size: 1.5rem; }
        .modal-close { background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; }
        .modal-body { padding: 25px; }
        .modal-footer { padding: 25px; border-top: 2px solid #f0f0f0; display: flex; gap: 15px; }
        
        .payment-method-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 25px; }
        .payment-method-btn { padding: 20px; border: 2px solid #e0e0e0; border-radius: 12px; background: white; cursor: pointer; transition: var(--transition); text-align: center; font-family: 'Montserrat', sans-serif; font-weight: 600; }
        .payment-method-btn:hover { border-color: var(--primary); transform: translateY(-3px); }
        .payment-method-btn.selected { border-color: var(--success); background: #E8F5E9; color: var(--success); }
        .payment-form { display: none; }
        .payment-form.show { display: block; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--secondary); font-family: 'Montserrat', sans-serif; }
        .form-group input { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 1rem; transition: var(--transition); }
        .form-group input:focus { outline: none; border-color: var(--primary); }
        .payment-summary { background: #f8f8f8; padding: 20px; border-radius: 12px; margin: 20px 0; }
        .summary-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #e0e0e0; }
        .summary-row.total { border-bottom: none; font-size: 1.3rem; font-weight: 700; color: var(--primary); font-family: 'Montserrat', sans-serif; }
        .change-display { background: var(--warning); color: white; padding: 15px; border-radius: 10px; text-align: center; margin: 15px 0; font-size: 1.2rem; font-weight: 700; display: none; }
        .change-display.show { display: block; }
        .special-options { background: #FFF3E0; border: 2px solid var(--warning); border-radius: 12px; padding: 20px; margin: 20px 0; }
        .special-option { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .special-option input[type="radio"] { width: 20px; height: 20px; }
        .special-input { margin-top: 10px; display: none; }
        .special-input.show { display: block; }
        .btn-modal { flex: 1; padding: 15px; border: none; border-radius: 10px; font-size: 1rem; font-weight: 700; cursor: pointer; transition: var(--transition); font-family: 'Montserrat', sans-serif; }
        .btn-modal.secondary { background: #f0f0f0; color: var(--secondary); }
        .btn-modal.primary { background: linear-gradient(135deg, var(--success), #2E7D32); color: white; }
        .btn-modal:disabled { background: #ccc; cursor: not-allowed; }
        
        .alert-modal .modal-content { max-width: 500px; text-align: center; }
        .alert-icon { font-size: 4rem; color: var(--warning); margin-bottom: 1rem; }
        .timer-badge { background: var(--warning); color: white; padding: 5px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: 700; display: inline-flex; align-items: center; gap: 5px; }
        .timer-badge.urgent { background: var(--danger); animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        
        .loading-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 4000; color: white; }
        .loading-overlay.show { display: flex; }
        .spinner { width: 60px; height: 60px; border: 5px solid rgba(255,255,255,0.3); border-top-color: var(--accent); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .empty-state { text-align: center; padding: 40px; color: #888; }
        .empty-state i { font-size: 3em; margin-bottom: 15px; color: #ddd; }
        
        .notification { position: fixed; top: 80px; right: 20px; background: white; padding: 20px 25px; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); display: none; align-items: center; gap: 15px; z-index: 5000; animation: slideIn 0.3s ease; border-left: 5px solid var(--success); }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .notification.show { display: flex; }
        
        .menu-item-card { background: white; border-radius: 12px; padding: 20px; margin-bottom: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); display: flex; gap: 15px; align-items: center; }
        .menu-item-img { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; color: #999; }
        .menu-item-info { flex: 1; }
        .menu-item-name { font-weight: 700; font-family: 'Montserrat', sans-serif; margin-bottom: 5px; }
        .menu-item-desc { font-size: 0.875rem; color: #666; margin-bottom: 5px; }
        .menu-item-price { font-size: 1.25rem; font-weight: 700; color: var(--primary); }
        .badge { padding: 5px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; }
        .badge-success { background: #E8F5E9; color: var(--success); }
        .badge-danger { background: #FFEBEE; color: var(--danger); }
        
        @media (max-width: 768px) {
            .tasa-bar { flex-direction: column; gap: 1rem; padding: 1rem; }
            .header { flex-direction: column; text-align: center; }
            .payment-method-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Alert Modal para Tasa del Día (Cajero) -->
    <div class="modal-overlay alert-modal" id="alertTasaModal">
        <div class="modal-content">
            <div class="modal-body" style="padding: 2rem;">
                <div class="alert-icon"><i class="fas fa-exclamation-triangle"></i></div>
                <h2 style="margin-bottom: 1rem; color: var(--secondary);">¡Buenos días!</h2>
                <p style="color: #666; margin-bottom: 1.5rem;">El administrador no ha establecido la <strong>tasa del dólar del día</strong>. Por favor, introdúcela para continuar.</p>
                <div style="background: #f8f8f8; padding: 1.5rem; border-radius: 0.75rem; margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--secondary);">Tasa del Día (Bs. por $1)</label>
                    <input type="number" step="0.01" id="tasaInicialInput" placeholder="0.00" style="width: 100%; padding: 1rem; font-size: 1.5rem; text-align: center; font-weight: 700; border: 2px solid var(--primary); border-radius: 0.5rem;">
                </div>
                <button class="btn-cobrar" onclick="guardarTasaInicial()" style="width: 100%; justify-content: center;">Guardar y Continuar</button>
            </div>
        </div>
    </div>

    <!-- Loading -->
    <div class="loading-overlay" id="loadingOverlay"><div class="spinner"></div><h2>Cargando panel...</h2></div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle" style="color: var(--success); font-size: 1.5rem;"></i>
        <div><h4 style="margin: 0; color: var(--secondary);">Éxito</h4><p id="notificationText" style="margin: 0; color: #666;">Operación completada</p></div>
    </div>

    <!-- Tasa del Día Bar -->
    <div class="tasa-bar">
        <div class="tasa-display">
            <span>Tasa del Día:</span>
            <input type="number" step="0.01" class="tasa-input" id="tasaDiaInput" placeholder="0.00">
            <span>Bs/$</span>
        </div>
        <button class="btn-tasa" onclick="actualizarTasaManual()"><i class="fas fa-sync-alt"></i> Actualizar</button>
    </div>

    <!-- Modal de Cobro -->
    <div class="modal-overlay" id="cobroModal">
        <div class="modal-content">
            <div class="modal-header"><h2><i class="fas fa-cash-register"></i> Procesar Cobro</h2><button class="modal-close" onclick="closeModal('cobroModal')"><i class="fas fa-times"></i></button></div>
            <div class="modal-body">
                <div class="payment-summary" id="cobroSummary"></div>
                <h3 style="font-family: 'Montserrat', sans-serif; margin-bottom: 15px;">Método de Pago</h3>
                <div class="payment-method-grid">
                    <button class="payment-method-btn" onclick="selectPaymentMethod('efectivo_bs')"><i class="fas fa-money-bill-wave"></i><br>Efectivo Bs</button>
                    <button class="payment-method-btn" onclick="selectPaymentMethod('efectivo_usd')"><i class="fas fa-dollar-sign"></i><br>Efectivo $</button>
                    <button class="payment-method-btn" onclick="selectPaymentMethod('pago_movil')"><i class="fas fa-mobile-alt"></i><br>Pago Móvil</button>
                    <button class="payment-method-btn" onclick="selectPaymentMethod('punto_venta')"><i class="fas fa-credit-card"></i><br>Punto de Venta</button>
                </div>
                <div class="payment-form" id="form-efectivo_bs"><div class="form-group"><label>Monto recibido (Bs)</label><input type="number" step="0.01" id="montoRecibidoBs" placeholder="0.00" oninput="calcularCambio()"></div></div>
                <div class="payment-form" id="form-efectivo_usd"><div class="form-group"><label>Monto recibido ($)</label><input type="number" step="0.01" id="montoRecibidoUsd" placeholder="0.00" oninput="calcularCambio()"></div><div class="form-group"><label>Tasa de cambio (Bs/$)</label><input type="number" id="tasaCambioCobro" readonly></div></div>
                <div class="payment-form" id="form-pago_movil"><div class="form-group"><label>Últimos 6 dígitos de referencia</label><input type="text" id="referenciaPago" placeholder="000000" maxlength="6"></div><div class="form-group"><label>Monto pagado (Bs)</label><input type="number" step="0.01" id="montoPagoMovil" placeholder="0.00" oninput="calcularCambio()"></div></div>
                <div class="payment-form" id="form-punto_venta"><div class="form-group"><label>Monto pagado (Bs)</label><input type="number" step="0.01" id="montoPuntoVenta" placeholder="0.00" oninput="calcularCambio()"></div></div>
                <div class="change-display" id="changeDisplay"></div>
                <div class="special-options" id="specialOptions" style="display: none;">
                    <h3><i class="fas fa-exclamation-circle"></i> Opciones de Diferencia</h3>
                    <div class="special-option"><input type="radio" name="specialOption" id="optNormal" value="normal" checked onchange="toggleSpecialInput()"><label for="optNormal">Cobro exacto</label></div>
                    <div class="special-option"><input type="radio" name="specialOption" id="optAfavor" value="afavor" onchange="toggleSpecialInput()"><label for="optAfavor">A favor (cliente debe)</label></div>
                    <div class="special-input" id="inputAfavor"><label>Monto a favor:</label><input type="number" id="montoAfavor" placeholder="0.00" readonly></div>
                    <div class="special-option"><input type="radio" name="specialOption" id="optCondonacion" value="condonacion" onchange="toggleSpecialInput()"><label for="optCondonacion">Condonación (no cobrar diferencia)</label></div>
                    <div class="special-input" id="inputCondonacion"><label>Monto condonado:</label><input type="number" id="montoCondonacion" placeholder="0.00" readonly></div>
                    <div class="special-option"><input type="radio" name="specialOption" id="optCasa" value="casa" onchange="toggleSpecialInput()"><label for="optCasa">Por parte de la casa (invitación)</label></div>
                    <div class="special-input" id="inputCasa"><label>Nombre de quien invita:</label><input type="text" id="nombreInvita" placeholder="Nombre del empleado/admin"></div>
                </div>
            </div>
            <div class="modal-footer"><button class="btn-modal secondary" onclick="closeModal('cobroModal')">Cancelar</button><button class="btn-modal primary" id="btnConfirmarCobro" onclick="confirmarCobro()" disabled>Confirmar Cobro</button></div>
        </div>
    </div>

    <!-- Modal de Rechazo -->
    <div class="modal-overlay" id="rechazoModal">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, var(--danger), #B71C1C);"><h2><i class="fas fa-times-circle"></i> Rechazar Pedido</h2><button class="modal-close" onclick="closeModal('rechazoModal')"><i class="fas fa-times"></i></button></div>
            <div class="modal-body">
                <p style="margin-bottom: 20px; color: #666;">Selecciona la razón del rechazo:</p>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <label style="display: flex; align-items: center; gap: 10px; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; cursor: pointer;"><input type="radio" name="rejectionReason" value="referencia_invalida" style="width: 20px; height: 20px;"><span>Referencia de pago inválida o falsa</span></label>
                    <label style="display: flex; align-items: center; gap: 10px; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; cursor: pointer;"><input type="radio" name="rejectionReason" value="monto_insuficiente" style="width: 20px; height: 20px;"><span>Monto insuficiente</span></label>
                    <label style="display: flex; align-items: center; gap: 10px; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; cursor: pointer;"><input type="radio" name="rejectionReason" value="datos_incorrectos" style="width: 20px; height: 20px;"><span>Datos de contacto/dirección incorrectos</span></label>
                    <label style="display: flex; align-items: center; gap: 10px; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; cursor: pointer;"><input type="radio" name="rejectionReason" value="no_disponible" style="width: 20px; height: 20px;"><span>Producto no disponible</span></label>
                    <label style="display: flex; align-items: center; gap: 10px; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; cursor: pointer;"><input type="radio" name="rejectionReason" value="fuera_horario" style="width: 20px; height: 20px;"><span>Fuera de horario de delivery</span></label>
                </div>
            </div>
            <div class="modal-footer"><button class="btn-modal secondary" onclick="closeModal('rechazoModal')">Cancelar</button><button class="btn-modal primary" style="background: linear-gradient(135deg, var(--danger), #B71C1C);" onclick="confirmarRechazo()">Confirmar Rechazo</button></div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <div class="header-left"><h1><i class="fas fa-cash-register"></i> Panel del Cajero</h1><p>Saki Sushi - Gestión de pedidos y cobros</p></div>
            <div class="header-right"><div class="sync-status offline" id="syncStatus"><i class="fas fa-sync-alt"></i><span>Conectando...</span></div></div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showSection('pedidos')"><i class="fas fa-clipboard-list"></i> Pedidos</button>
            <button class="nav-tab" onclick="showSection('menu')"><i class="fas fa-utensils"></i> Ver Menú</button>
        </div>

        <div class="content">
            <!-- Sección Pedidos -->
            <div class="section active" id="section-pedidos">
                <h2 class="section-title"><i class="fas fa-clipboard-list"></i> Pedidos del Día</h2>
                <div class="stats-grid">
                    <div class="stat-card" onclick="showHistorial('pendientes')"><div class="stat-icon pendientes"><i class="fas fa-clock"></i></div><div class="stat-value" id="statPendientes">0</div><div class="stat-label">Pendientes</div></div>
                    <div class="stat-card" onclick="showHistorial('cobrados')"><div class="stat-icon cobrados"><i class="fas fa-check-circle"></i></div><div class="stat-value" id="statCobrados">0</div><div class="stat-label">Cobrados Hoy</div></div>
                    <div class="stat-card" onclick="showHistorial('ventas')"><div class="stat-icon ventas"><i class="fas fa-dollar-sign"></i></div><div class="stat-value" id="statVentas">Bs. 0</div><div class="stat-label">Ventas Totales</div></div>
                    <div class="stat-card" onclick="showHistorial('platillos')"><div class="stat-icon platillos"><i class="fas fa-utensils"></i></div><div class="stat-value" id="statPlatillos">0</div><div class="stat-label">Platillos Vendidos</div></div>
                </div>

                <div class="orders-container" id="ordersContainer">
                    <div class="order-column">
                        <div class="order-column-header mesa"><i class="fas fa-chair"></i> MESA</div>
                        <div class="order-column-content" id="colMesa"><div class="empty-state"><i class="fas fa-inbox"></i><p>No hay pedidos en mesa</p></div></div>
                    </div>
                    <div class="order-column">
                        <div class="order-column-header delivery"><i class="fas fa-motorcycle"></i> DELIVERY</div>
                        <div class="order-column-content" id="colDelivery"><div class="empty-state"><i class="fas fa-inbox"></i><p>No hay pedidos delivery</p></div></div>
                    </div>
                    <div class="order-column">
                        <div class="order-column-header reserva"><i class="fas fa-calendar-check"></i> RESERVAS</div>
                        <div class="order-column-content" id="colReserva"><div class="empty-state"><i class="fas fa-inbox"></i><p>No hay reservas</p></div></div>
                    </div>
                </div>
            </div>

            <!-- Sección Ver Menú -->
            <div class="section" id="section-menu">
                <h2 class="section-title"><i class="fas fa-utensils"></i> Menú Actual</h2>
                <div id="menuViewContainer"></div>
            </div>
        </div>
    </div>

    <script>
        // Configuración JSONBin
        const JSONBIN_CONFIG = {
            BIN_ID: '69879d6e43b1c97be96d2b13',
            API_KEY: '$2a$10$.klBAMlOBlE9CoVh5iUFf.x3LEYKWiP6hhvvPETK9e8pyIuNB2F4K',
            BASE_URL: 'https://api.jsonbin.io/v3/b'
        };

        let sistemaData = null;
        let syncInterval = null;
        let currentPedido = null;
        let currentPaymentMethod = null;
        let pedidoRechazo = null;
        let cajeroActual = 'Cajero Principal'; // En producción vendría del login

        // Inicialización
        document.addEventListener('DOMContentLoaded', async () => {
            await cargarDatos();
            verificarTasaDelDia();
            syncInterval = setInterval(cargarDatos, 10000);
        });

        async function cargarDatos() {
            actualizarEstadoSync('syncing');
            try {
                const response = await fetch(`${JSONBIN_CONFIG.BASE_URL}/${JSONBIN_CONFIG.BIN_ID}/latest`, {
                    method: 'GET',
                    headers: { 'X-Master-Key': JSONBIN_CONFIG.API_KEY, 'X-Bin-Meta': 'false' }
                });
                if (!response.ok) throw new Error('Error al cargar datos');
                const data = await response.json();
                sistemaData = data.record || data;
                limpiarPedidosDiaAnterior();
                actualizarEstadoSync('online');
                document.getElementById('loadingOverlay').style.display = 'none';
                actualizarVista();
            } catch (error) {
                console.error('Error cargando datos:', error);
                actualizarEstadoSync('offline');
            }
        }

        function limpiarPedidosDiaAnterior() {
            if (!sistemaData.pedidos) return;
            const hoy = new Date().toISOString().split('T')[0];
            const pedidosHoy = [];
            const pedidosArchivar = [];
            
            sistemaData.pedidos.forEach(p => {
                if (p.timestamp.startsWith(hoy)) pedidosHoy.push(p);
                else if (p.estado === 'cobrado') pedidosArchivar.push(p);
            });
            
            if (pedidosArchivar.length > 0) {
                if (!sistemaData.ventas) sistemaData.ventas = { diarias: [], semanales: [], mensuales: [] };
                pedidosArchivar.forEach(p => {
                    sistemaData.ventas.diarias.push({ 
                        fecha: p.timestamp, 
                        pedidoId: p.id, 
                        total: p.total, 
                        items: p.items?.length || 0, 
                        metodoPago: p.metodoPago, 
                        tipo: p.tipo || 'mesa',
                        cajero: p.cajero || 'Desconocido'
                    });
                });
            }
            sistemaData.pedidos = pedidosHoy;
        }

        // Verificar Tasa del Día (Cajero puede establecerla si Admin no lo hizo)
        function verificarTasaDelDia() {
            if (!sistemaData || !sistemaData.config) return;
            const hoy = new Date().toISOString().split('T')[0];
            const ultimaFecha = sistemaData.config.ultimaActualizacion ? sistemaData.config.ultimaActualizacion.split('T')[0] : null;
            
            if (ultimaFecha !== hoy || sistemaData.config.tasaCambio === 0) {
                document.getElementById('alertTasaModal').classList.add('show');
            } else {
                actualizarDisplayTasa();
            }
        }

        async function guardarTasaInicial() {
            const tasa = parseFloat(document.getElementById('tasaInicialInput').value);
            if (!tasa || tasa <= 0) { alert('Introduce una tasa válida'); return; }
            
            sistemaData.config.tasaCambio = tasa;
            sistemaData.config.ultimaActualizacion = new Date().toISOString();
            if (!sistemaData.config.fechaInicioAumento) sistemaData.config.fechaInicioAumento = new Date().toISOString();
            
            await guardarCambios();
            document.getElementById('alertTasaModal').classList.remove('show');
            actualizarDisplayTasa();
            actualizarVista();
            mostrarNotificacion('Tasa del día guardada correctamente');
        }

        async function actualizarTasaManual() {
            const tasa = parseFloat(document.getElementById('tasaDiaInput').value);
            if (!tasa || tasa <= 0) { alert('Introduce una tasa válida'); return; }
            
            sistemaData.config.tasaCambio = tasa;
            sistemaData.config.ultimaActualizacion = new Date().toISOString();
            
            await guardarCambios();
            actualizarDisplayTasa();
            actualizarVista();
            mostrarNotificacion('Tasa actualizada correctamente');
        }

        function actualizarDisplayTasa() {
            const tasa = sistemaData?.config?.tasaCambio || 0;
            document.getElementById('tasaDiaInput').value = tasa || '';
            document.getElementById('tasaCambioCobro').value = tasa.toFixed(2);
        }

        // Vistas
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(`section-${sectionName}`).classList.add('active');
            event.target.classList.add('active');
            if (sectionName === 'pedidos') renderPedidos();
            if (sectionName === 'menu') renderMenuView();
        }

        function actualizarVista() {
            renderPedidos();
            renderMenuView();
        }

        function renderPedidos() {
            if (!sistemaData) return;
            const pedidos = sistemaData.pedidos || [];
            const hoy = new Date().toISOString().split('T')[0];
            const pedidosHoy = pedidos.filter(p => p.timestamp.startsWith(hoy));
            
            const pendientes = pedidosHoy.filter(p => p.estado === 'pendiente');
            const cobrados = pedidosHoy.filter(p => p.estado === 'cobrado');
            
            document.getElementById('statPendientes').textContent = pendientes.length;
            document.getElementById('statCobrados').textContent = cobrados.length;
            
            const tasa = sistemaData.config.tasaCambio || 400;
            const totalVentas = cobrados.reduce((sum, p) => sum + (p.total || 0), 0);
            document.getElementById('statVentas').textContent = `Bs. ${(totalVentas * tasa).toFixed(0)}`;
            
            const totalPlatillos = cobrados.reduce((sum, p) => sum + (p.items?.reduce((itemSum, item) => itemSum + (item.cantidad || 1), 0) || 0), 0);
            document.getElementById('statPlatillos').textContent = totalPlatillos;
            
            renderColumna('colMesa', pendientes.filter(p => p.tipo === 'mesa' || !p.tipo), 'mesa');
            renderColumna('colDelivery', pendientes.filter(p => p.tipo === 'delivery'), 'delivery');
            renderColumna('colReserva', pendientes.filter(p => p.tipo === 'reserva'), 'reserva');
        }

        function renderColumna(columnId, pedidos, tipo) {
            const col = document.getElementById(columnId);
            if (pedidos.length === 0) {
                col.innerHTML = `<div class="empty-state"><i class="fas fa-inbox"></i><p>No hay pedidos ${tipo}</p></div>`;
                return;
            }
            col.innerHTML = pedidos.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)).map(p => crearCardPedido(p, tipo)).join('');
        }

        function crearCardPedido(pedido, tipo) {
            const fecha = new Date(pedido.timestamp);
            const hora = fecha.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
            const tasa = sistemaData.config.tasaCambio || 400;
            const minutosTranscurridos = Math.floor((new Date() - fecha) / 60000);
            
            let timerText = '';
            if (pedido.tipo === 'delivery') {
                const minutosRestantes = 25 - minutosTranscurridos;
                timerText = minutosRestantes > 0 ? `<div class="timer-badge ${minutosRestantes <= 5 ? 'urgent' : ''}"><i class="fas fa-clock"></i> ${minutosRestantes}min restantes</div>` : '<div class="timer-badge urgent"><i class="fas fa-clock"></i> Tiempo agotado</div>';
            }
            
            const itemsHtml = (pedido.items || []).map(item => {
                const personalizacion = item.personalizacion?.length > 0 ? ` <small style="color: #666;">(Sin ${item.personalizacion.join(', ')})</small>` : '';
                const cantidad = item.cantidad || 1;
                return `<div class="order-detail-row"><span>${cantidad}x ${item.nombre}${personalizacion}</span><span>Bs. ${((item.subtotal || 0) * tasa).toFixed(2)}</span></div>`;
            }).join('');
            
            const total = (pedido.total || 0) * tasa;
            
            let extraInfo = '';
            if (pedido.tipo === 'delivery') {
                extraInfo = `<div style="background: #E3F2FD; border: 2px solid var(--info); border-radius: 8px; padding: 10px; margin-bottom: 10px; font-size: 0.85rem;"><div><i class="fas fa-map-marker-alt"></i> ${pedido.direccion}</div><div><i class="fas fa-phone"></i> ${pedido.telefono}</div>${pedido.referencia ? `<div><i class="fas fa-receipt"></i> Ref: ${pedido.referencia}</div>` : ''}</div>${timerText}`;
            } else if (pedido.tipo === 'reserva') {
                extraInfo = `<div style="background: #E3F2FD; border: 2px solid var(--info); border-radius: 8px; padding: 10px; margin-bottom: 10px; font-size: 0.85rem;"><div><i class="fas fa-user"></i> ${pedido.clienteNombre || 'No especificado'}</div><div><i class="fas fa-calendar"></i> ${pedido.fechaReserva ? new Date(pedido.fechaReserva).toLocaleDateString() : 'No especificada'}</div>${pedido.referencia ? `<div><i class="fas fa-receipt"></i> Ref: ${pedido.referencia}</div>` : ''}</div>`;
            } else {
                extraInfo = `<div style="margin-bottom: 10px; font-weight: 700; color: var(--info);"><i class="fas fa-chair"></i> Mesa #${pedido.mesa || '--'}</div>`;
            }
            
            const botonesRechazo = (pedido.tipo === 'delivery' || pedido.tipo === 'reserva') ? `<button class="btn btn-rechazar" onclick="mostrarRechazo('${pedido.id}')"><i class="fas fa-times"></i> Rechazar</button>` : '';
            
            // Mostrar si ya está asignado a otro cajero
            const asignacionInfo = pedido.cajero && pedido.cajero !== cajeroActual ? `<div style="background: #FFF3E0; border: 1px solid var(--warning); border-radius: 5px; padding: 5px; margin-bottom: 10px; font-size: 0.75rem; color: var(--warning);"><i class="fas fa-user-clock"></i> Asignado a: ${pedido.cajero}</div>` : '';
            
            return `<div class="order-card">${asignacionInfo}<div class="order-card-header"><span class="order-id">${pedido.id}</span><span class="order-time"><i class="fas fa-clock"></i> ${hora}</span></div>${extraInfo}<div class="order-details">${itemsHtml}</div><div class="order-total">Total: Bs. ${total.toFixed(2)}</div><div class="order-actions"><button class="btn btn-cobrar" onclick="mostrarCobro('${pedido.id}')"><i class="fas fa-check"></i> Cobrar</button>${botonesRechazo}</div></div>`;
        }

        // Renderizar Menú (sincronizado con Admin)
        function renderMenuView() {
            const container = document.getElementById('menuViewContainer');
            if (!sistemaData || !sistemaData.menu) return;
            
            const tasa = sistemaData.config.tasaCambio || 400;
            
            container.innerHTML = sistemaData.menu.map(item => {
                const precioBs = ((item.precio || 0) * tasa).toFixed(2);
                
                // Calcular disponibilidad real basada en inventario
                let disponible = item.disponible;
                let stockReal = item.stock || 0;
                
                if (disponible && item.ingredientes) {
                    // Verificar stock real de ingredientes
                    let maxPlatillos = Infinity;
                    Object.entries(item.ingredientes).forEach(([ingId, data]) => {
                        const ing = sistemaData.inventario[ingId];
                        if (ing) {
                            const cantidadNecesaria = convertirUnidad(data.cantidad, data.unidad || 'unidades', ing.unidad || 'unidades');
                            const disponibleIng = Math.floor(ing.stock / cantidadNecesaria);
                            maxPlatillos = Math.min(maxPlatillos, disponibleIng);
                        } else {
                            maxPlatillos = 0;
                        }
                    });
                    if (maxPlatillos === Infinity || maxPlatillos < 0) maxPlatillos = 0;
                    stockReal = maxPlatillos;
                    disponible = maxPlatillos > 0 && item.disponible;
                }
                
                return `
                    <div class="menu-item-card">
                        ${item.imagen ? `<img src="${item.imagen}" class="menu-item-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'"><div class="menu-item-img" style="display: none;"><i class="fas fa-image"></i></div>` : '<div class="menu-item-img"><i class="fas fa-image"></i></div>'}
                        <div class="menu-item-info">
                            <div class="menu-item-name">${item.nombre}</div>
                            <div class="menu-item-desc">${item.descripcion || 'Sin descripción'}</div>
                            <span class="badge ${disponible ? 'badge-success' : 'badge-danger'}">${disponible ? 'Disponible' : 'No disponible'}${disponible ? ` (${stockReal} unidades)` : ''}</span>
                        </div>
                        <div class="menu-item-price">Bs. ${precioBs}<br><small style="color: #666; font-size: 0.75rem;">$${(item.precio || 0).toFixed(2)}</small></div>
                    </div>
                `;
            }).join('');
        }

        // Cobro
        function mostrarCobro(pedidoId) {
            currentPedido = sistemaData.pedidos.find(p => p.id === pedidoId);
            if (!currentPedido) return;
            
            // Asignar pedido a este cajero si no está asignado
            if (!currentPedido.cajero) {
                currentPedido.cajero = cajeroActual;
            }
            
            const modal = document.getElementById('cobroModal');
            const summary = document.getElementById('cobroSummary');
            const tasa = sistemaData.config.tasaCambio || 400;
            const total = (currentPedido.total || 0) * tasa;
            
            let itemsHtml = (currentPedido.items || []).map(item => {
                const personalizacion = item.personalizacion?.length > 0 ? ` <small style="color: #666;">(Sin ${item.personalizacion.join(', ')})</small>` : '';
                const cantidad = item.cantidad || 1;
                return `<div class="summary-row"><span>${cantidad}x ${item.nombre}${personalizacion}</span><span>Bs. ${((item.subtotal || 0) * tasa).toFixed(2)}</span></div>`;
            }).join('');
            
            summary.innerHTML = `${itemsHtml}<div class="summary-row total"><span>TOTAL A PAGAR</span><span>Bs. ${total.toFixed(2)}</span></div>`;
            
            document.querySelectorAll('.payment-method-btn').forEach(btn => btn.classList.remove('selected'));
            document.querySelectorAll('.payment-form').forEach(form => form.classList.remove('show'));
            document.getElementById('specialOptions').style.display = 'none';
            document.getElementById('changeDisplay').classList.remove('show');
            document.getElementById('btnConfirmarCobro').disabled = true;
            
            modal.classList.add('show');
        }

        function selectPaymentMethod(method) {
            currentPaymentMethod = method;
            document.querySelectorAll('.payment-method-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.closest('.payment-method-btn').classList.add('selected');
            document.querySelectorAll('.payment-form').forEach(form => form.classList.remove('show'));
            document.getElementById(`form-${method}`).classList.add('show');
            document.getElementById('btnConfirmarCobro').disabled = false;
        }

        function calcularCambio() {
            if (!currentPedido) return;
            const tasa = sistemaData.config.tasaCambio || 400;
            const total = (currentPedido.total || 0) * tasa;
            let recibido = 0;
            
            if (currentPaymentMethod === 'efectivo_bs') recibido = parseFloat(document.getElementById('montoRecibidoBs').value) || 0;
            else if (currentPaymentMethod === 'efectivo_usd') recibido = (parseFloat(document.getElementById('montoRecibidoUsd').value) || 0) * tasa;
            else if (currentPaymentMethod === 'pago_movil') recibido = parseFloat(document.getElementById('montoPagoMovil').value) || 0;
            else if (currentPaymentMethod === 'punto_venta') recibido = parseFloat(document.getElementById('montoPuntoVenta').value) || 0;
            
            const diferencia = recibido - total;
            const changeDisplay = document.getElementById('changeDisplay');
            const specialOptions = document.getElementById('specialOptions');
            
            if (diferencia > 0) {
                changeDisplay.innerHTML = `<i class="fas fa-hand-holding-usd"></i> CAMBIO A ENTREGAR: Bs. ${diferencia.toFixed(2)}`;
                changeDisplay.classList.add('show');
                specialOptions.style.display = 'none';
            } else if (diferencia < 0) {
                changeDisplay.innerHTML = `<i class="fas fa-exclamation-circle"></i> FALTAN: Bs. ${Math.abs(diferencia).toFixed(2)}`;
                changeDisplay.classList.add('show');
                specialOptions.style.display = 'block';
                document.getElementById('montoAfavor').value = Math.abs(diferencia).toFixed(2);
                document.getElementById('montoCondonacion').value = Math.abs(diferencia).toFixed(2);
            } else {
                changeDisplay.classList.remove('show');
                specialOptions.style.display = 'none';
            }
        }

        function toggleSpecialInput() {
            const selected = document.querySelector('input[name="specialOption"]:checked').value;
            document.getElementById('inputAfavor').classList.toggle('show', selected === 'afavor');
            document.getElementById('inputCondonacion').classList.toggle('show', selected === 'condonacion');
            document.getElementById('inputCasa').classList.toggle('show', selected === 'casa');
        }

        async function confirmarCobro() {
            if (!currentPedido) return;
            const tasa = sistemaData.config.tasaCambio || 400;
            const total = (currentPedido.total || 0) * tasa;
            let recibido = 0;
            let metodoPago = currentPaymentMethod;
            let referencia = '';
            
            if (currentPaymentMethod === 'efectivo_bs') recibido = parseFloat(document.getElementById('montoRecibidoBs').value) || 0;
            else if (currentPaymentMethod === 'efectivo_usd') recibido = parseFloat(document.getElementById('montoRecibidoUsd').value) || 0;
            else if (currentPaymentMethod === 'pago_movil') {
                recibido = parseFloat(document.getElementById('montoPagoMovil').value) || 0;
                referencia = document.getElementById('referenciaPago').value || '000000';
            } else if (currentPaymentMethod === 'punto_venta') recibido = parseFloat(document.getElementById('montoPuntoVenta').value) || 0;
            
            const diferencia = recibido - total;
            const specialOption = document.querySelector('input[name="specialOption"]:checked')?.value || 'normal';
            
            // Actualizar pedido
            currentPedido.estado = 'cobrado';
            currentPedido.cajero = cajeroActual;
            currentPedido.fechaCobro = new Date().toISOString();
            currentPedido.metodoPago = metodoPago;
            currentPedido.montoRecibido = recibido;
            currentPedido.referencia = referencia;
            
            if (diferencia < 0) {
                currentPedido.diferencia = Math.abs(diferencia);
                currentPedido.tipoDiferencia = specialOption;
                if (specialOption === 'casa') currentPedido.invitadoPor = document.getElementById('nombreInvita').value;
            } else if (diferencia > 0) currentPedido.cambio = diferencia;
            
            // Guardar cambios en el servidor
            await guardarCambios();
            
            // Cerrar modal y actualizar vista inmediatamente
            closeModal('cobroModal');
            
            // IMPORTANTE: Actualizar la vista para reflejar el cambio
            actualizarVista();
            
            mostrarNotificacion('Cobro procesado correctamente');
        }

        // Rechazo
        function mostrarRechazo(pedidoId) {
            pedidoRechazo = sistemaData.pedidos.find(p => p.id === pedidoId);
            
            // Asignar pedido a este cajero si no está asignado
            if (pedidoRechazo && !pedidoRechazo.cajero) {
                pedidoRechazo.cajero = cajeroActual;
            }
            
            document.getElementById('rechazoModal').classList.add('show');
        }

        async function confirmarRechazo() {
            const razon = document.querySelector('input[name="rejectionReason"]:checked')?.value;
            if (!razon) { alert('Selecciona una razón de rechazo'); return; }
            if (!pedidoRechazo) return;
            
            pedidoRechazo.estado = 'rechazado';
            pedidoRechazo.razonRechazo = razon;
            pedidoRechazo.fechaRechazo = new Date().toISOString();
            
            // Restaurar stock
            if (pedidoRechazo.items) {
                pedidoRechazo.items.forEach(item => {
                    const platillo = sistemaData.menu.find(p => p.id === item.platilloId);
                    if (platillo && platillo.ingredientes) {
                        Object.entries(platillo.ingredientes).forEach(([ingKey, ingData]) => {
                            if (!item.personalizacion?.includes(ingKey)) {
                                if (sistemaData.inventario[ingKey]) {
                                    const cantidadARestaurar = (ingData.cantidad || 1) * (item.cantidad || 1);
                                    sistemaData.inventario[ingKey].stock += cantidadARestaurar;
                                }
                            }
                        });
                    }
                });
            }
            
            await guardarCambios();
            closeModal('rechazoModal');
            
            // IMPORTANTE: Actualizar la vista para reflejar el cambio
            actualizarVista();
            
            mostrarNotificacion('Pedido rechazado. Cliente notificado.');
        }

        // Utilidades
        function closeModal(modalId) { document.getElementById(modalId).classList.remove('show'); }
        function mostrarNotificacion(mensaje) {
            const notif = document.getElementById('notification');
            document.getElementById('notificationText').textContent = mensaje;
            notif.classList.add('show');
            setTimeout(() => notif.classList.remove('show'), 3000);
        }
        function actualizarEstadoSync(estado) {
            const statusEl = document.getElementById('syncStatus');
            const iconEl = statusEl.querySelector('i');
            const textEl = statusEl.querySelector('span');
            statusEl.className = `sync-status ${estado}`;
            switch(estado) {
                case 'online': iconEl.className = 'fas fa-check-circle'; textEl.textContent = 'Sincronizado'; break;
                case 'syncing': iconEl.className = 'fas fa-sync-alt fa-spin'; textEl.textContent = 'Sincronizando...'; break;
                case 'offline': iconEl.className = 'fas fa-exclamation-triangle'; textEl.textContent = 'Sin conexión'; break;
            }
        }
        async function guardarCambios() {
            try {
                await fetch(`${JSONBIN_CONFIG.BASE_URL}/${JSONBIN_CONFIG.BIN_ID}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json', 'X-Master-Key': JSONBIN_CONFIG.API_KEY },
                    body: JSON.stringify(sistemaData)
                });
            } catch (error) { console.error('Error guardando:', error); }
        }
        
        // Función de conversión de unidades
        function convertirUnidad(valor, desde, hacia) {
            if (desde === hacia) return valor;
            
            const factores = {
                'unidades': 1,
                'gramos': 1, 'kilogramos': 1000,
                'ml': 1, 'litros': 1000
            };
            
            // Convertir a base
            let enBase = valor * (factores[desde] || 1);
            
            // Convertir de base a destino
            return enBase / (factores[hacia] || 1);
        }
        
        window.addEventListener('beforeunload', () => { if (syncInterval) clearInterval(syncInterval); });
    </script>
</body>
</html>
